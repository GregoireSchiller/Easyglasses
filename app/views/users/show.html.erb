<div class="wrapper-grey-padding-top">


  <h1 style="text-align: center; margin-bottom: 40px;"><%= 'Hello, ' %><%= @user.first_name %></h1>
  <hr>

  <div class="container text-center">
    <h3 style="padding-left: 15px"><strong>My account</strong></h3>
    <div class="row">
      <div class="col-xs-12 col-sm-6">
        <h4>Name: <%= @user.first_name %> <%= @user.last_name %> </h4>
        <h4>DOB: <%= @user.date_of_birth %> </h4>
        <h4>City: <%= @user.city %> </h4>
      </div>
      <div class="col-xs-12 col-sm-6">
        <h4>Shoe size: <%= @user.shoe_size %> </h4>
        <h4>Email: <%= @user.email %> </h4>
        <h4>Phone number: +33<%= @user.phone_number %> </h4>
      </div>
    </div>
    <%= link_to "Edit my account", edit_user_registration_path, class: "btn btn-lg btn-primary" %>
  </div>
  <hr>

  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-8">
        <div class="scroll_fix">
        <h3><strong>Your record history</strong></h3>
        <% vision_test_number = 1 %>
          <% current_user.patient_exams.each do |exam| %>
            <div class="row">
              <div class="col-xs-12 col-sm-6">
                <div class="card">
                  <div class="card_title">Vision test nÂ°<%= vision_test_number %></div>
                  <% vision_test_number += 1 %>
                  <div class="test_results">
                    <h2>Vision score: <%= exam.score_total %></h2>
                    <p>Left eye: <%= exam.score_left %></p>
                    <p>Right eye: <%= exam.score_right %></p>
                  </div>
                  <div class="test_date">
                    <p>Test date: <%= exam.exam_date %></p>
                  </div>
                  <%= link_to "", desktop_results_exam_path(exam), class: "card-link" %>
                </div>
              </div>
              <div class="col-xs-12 col-sm-6">
                <% if exam.prescription %>
                  <% if exam.prescription.status == "Pending" %>
                    <div class="flexxbox">
                      <p class="flexx-item" style="color: orange;">PRESCRIPTION STATUS: PENDING</p>
                    </div>
                  <% elsif exam.prescription.status == "Sent" %>
                    <div class="flexxbox">
                      <p class="flexx-item" style="color: #60B65B;">PRESCRIPTION STATUS: SENT</p>
                    </div>
                  <% end %>
                <% else %>
                  <div class="flexxbox">
                    <p class="flexx-item" style="color: #D23333;">PRESCRIPTION STATUS: NOT REQUESTED</p>
                  </div>
                <% end %>
              </div>
            </div>
            <hr>
          <% end %>
        </div>
      </div>

      <div class="col-xs-12 col-sm-6 col-md-4">

        <div class="fixed-item hidden" id="review_form">
          <h3><strong>Give us a feedback</strong></h3>
          <%= simple_form_for([@user, @review]) do |f| %>
            <div><%= f.input :rating, label: false, :collection => 1..5, include_blank: "Give a mark" %></div>
            <div><%= f.input :description, label: false, hint: '5 words min - 100 words max', input_html: { placeholder: "Please detail your feedback" } %></div>
            <%= f.input :user_id, :as => :hidden, :input_html => { :value => @user.id } %>
            <div class="text-center"> <%= f.button :submit, "Submit rating", class: "btn btn-primary" %> </div>
          <% end %>
        </div>

        <div class="row">
          <% if !@user.review.nil? %>
          <h3><strong>Your feedback</strong></h3>
          <div class="card fixed-item hidden" id="review_card">
            <div class="card_title"></div>
            <div class="rating">
              <% @user.review.rating.times do %>
                <i class="fa fa-star" aria-hidden="true" style="color: #FFBE00;"></i>
              <% end %>
              <% (5 - @user.review.rating).times do %>
                <i class="fa fa-star-o" aria-hidden="true" style="color: grey;"></i>
              <% end %>
            </div>
            <div class="review_content">
              <h4>Your comment:</h4><br>
              <p>"<%= @user.review.description %>"</p>
            </div>
            <a class="card-link" href="#" ></a>
          </div>
        </div>


        <div class="row flexbox">
          <% if @user == current_user %>
            <div class="hidden flex-item" id="delete_button"><%= link_to fa_icon('trash-o'), user_review_path(@user, @review), method: :delete, style: "color: #D44950; font-size: 30px;" %></div>
          <% end %>

          <% if @user == current_user %>
            <div class="hidden flex-item" style="cursor: pointer" id="edit_button">
              <i class="fa fa-pencil" aria-hidden="true" style="color: grey; font-size: 30px;"></i>
            </div>
          <% end %>
        </div>

          <% end %>

      </div>
    </div>
  </div>

</div>

<%= content_for :after_js do %>
  <script>
    var no_review = "<%= @review.id.nil? %>"
    console.log("test: " + no_review)
    if (no_review == "true") {
      console.log("no review");
      $("#review_form").removeClass("hidden");
    }
    else {
      console.log("review");
      $("#review_card").removeClass("hidden");
      $("#delete_button").removeClass("hidden");
      $("#edit_button").removeClass("hidden");
    }
    $('#edit_button').click(function(){
      $("#review_card").addClass("hidden");
      $("#review_form").removeClass("hidden");
      $("#delete_button").addClass("hidden");
      $("#edit_button").addClass("hidden");
    })


  </script>

<% end %>
