<h1 style="text-align: center; margin-bottom: 40px;"><%= 'Hello, ' %><%= @user.first_name %></h1>
<hr>

<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-6 col-md-8">
      <div class="scroll_fix">
      <h4>Your record history</h4>
      <% vision_test_number = 1 %>
        <% current_user.exams.each do |exam| %>
          <div class="card">
            <div class="card_title">Vision test nÂ°<%= vision_test_number %></div>
            <% vision_test_number += 1 %>
            <div class="test_results">
              <h2>Vision score: <%= exam.score_total %></h2>
              <p>Left eye: <%= exam.score_left %></p>
              <p>Right eye: <%= exam.score_right %></p>
            </div>
            <div class="test_date">
              <p>Test date: <%= exam.date %></p>
            </div>
            <a class="card-link" href="#" ></a>
          </div>
          <hr>
        <% end %>
      </div>
    </div>

    <div class="col-xs-12 col-sm-6 col-md-4">

      <div class="fixed-item hidden" id="review_form">
        <h4>Give us a feedback</h4>
        <%= simple_form_for([@user, @review]) do |f| %>
          <div><%= f.input :rating, label: false, :collection => 1..5, include_blank: "Give a mark" %></div>
          <div><%= f.input :description, label: false, hint: '5 words min - 100 words max', input_html: { placeholder: "Please detail your feedback" } %></div>
          <%= f.input :user_id, :as => :hidden, :input_html => { :value => @user.id } %>
          <div class="text-center"> <%= f.button :submit, "Submit rating", class: "btn btn-primary" %> </div>
        <% end %>
      </div>

      <div class="row">
        <% if !@user.review.nil? %>
        <div class="card fixed-item hidden" id="review_card">
          <div class="card_title">Your feedback on the website</div>
          <div class="rating">
            <% @user.review.rating.times do %>
              <i class="fa fa-star" aria-hidden="true" style="color: #FFBE00;"></i>
            <% end %>
            <% (5 - @user.review.rating).times do %>
              <i class="fa fa-star-o" aria-hidden="true" style="color: grey;"></i>
            <% end %>
          </div>
          <div class="review_content">
            <h4>Your comment:</h4><br>
            <p>"<%= @user.review.description %>"</p>
          </div>
          <a class="card-link" href="#" ></a>
        </div>
      </div>


      <div class="row flexbox">
        <% if @user == current_user %>
          <div class="hidden flex-item" id="delete_button"><%= link_to fa_icon('trash-o'), user_review_path(@user, @review), method: :delete, style: "color: #D44950; font-size: 30px;" %></div>
        <% end %>

        <% if @user == current_user %>
          <div class="hidden flex-item" style="cursor: pointer" id="edit_button">
            <i class="fa fa-pencil" aria-hidden="true" style="color: grey; font-size: 30px;"></i>
          </div>
        <% end %>
      </div>

        <% end %>

    </div>
  </div>
</div>

<%= content_for :after_js do %>
  <script>
    var no_review = "<%= @review.id.nil? %>"
    console.log("test: " + no_review)
    if (no_review == "true") {
      console.log("no review");
      $("#review_form").removeClass("hidden");
    }
    else {
      console.log("review");
      $("#review_card").removeClass("hidden");
      $("#delete_button").removeClass("hidden");
      $("#edit_button").removeClass("hidden");
    }
    $('#edit_button').click(function(){
      $("#review_card").addClass("hidden");
      $("#review_form").removeClass("hidden");
      $("#delete_button").addClass("hidden");
      $("#edit_button").addClass("hidden");
    })


  </script>

<% end %>
